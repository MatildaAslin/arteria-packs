
# Demultiplexing
# Setups up a runfolder for demultiplexing assuming that the samplesheet and
#
#

version: "2.0" # mistral version

arteria-packs.demultiplex:

    type: direct
    input:
        - host
        - username
        - password
        - runfolder
        - samplesheet_location
        - barcode_mismatches
        - tiles
        - use_bases_mask
        - bcl2fastq_additional_arguments

    tasks:

        # TODO This should be pulled from the
        #      Hermes sever instead in the future.
        download_samplesheet:
            action: arteria-packs.copy_samplesheet
            input:
                runfolder: <% $.runfolder %>
                samplesheet_location: <% $.samplesheet_location %>
                username: <% $.username %>
                password: <% $.password %>
                hosts: <% $.host %>
            on-success:
                - get_tiles_to_include

        run_bcl2fastq:
            action: arteria-packs.bcl2fastq
            input:
                hosts: <% $.host %>
                input: <% $.runfolder %>
                output: "/data/scratch/<% $.runfolder %>"
                barcode_mismatches: <% $.barcode_mismatches %>
                tiles: <% $.tiles %>
                use_bases_mask: <% $.use_bases_mask %>
                additional_arguments: <% $.bcl2fastq_additional_arguments %>
                username: <% $.username %>
                password: <% $.password %>
